<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISHA èª²ç¨‹æª¢ç´¢ç³»çµ± (ç¨ç«‹ç‰ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Babel for in-browser compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f4f7f9;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "@google/genai": "https://esm.sh/@google/genai@0.1.1" 
      }
    }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module" data-presets="typescript,react">
        import React, { useState, useEffect } from 'react';
        import ReactDOM from 'react-dom/client';
        import { GoogleGenAI, Type } from '@google/genai';

        // ==========================================
        // CONFIGURATION
        // ==========================================
        // è«‹åœ¨æ­¤è™•å¡«å…¥æ‚¨çš„ API Key
        const API_KEY = "YOUR_API_KEY"; 

        // ==========================================
        // CONSTANTS
        // ==========================================
        const CITIES = [
          "è‡ºåŒ—å¸‚", "æ–°åŒ—å¸‚", "æ¡ƒåœ’å¸‚", "è‡ºä¸­å¸‚", "è‡ºå—å¸‚", "é«˜é›„å¸‚",
          "åŸºéš†å¸‚", "æ–°ç«¹å¸‚", "æ–°ç«¹ç¸£", "è‹—æ —ç¸£", "å½°åŒ–ç¸£", "å—æŠ•ç¸£",
          "é›²æ—ç¸£", "å˜‰ç¾©å¸‚", "å˜‰ç¾©ç¸£", "å±æ±ç¸£", "å®œè˜­ç¸£", "èŠ±è“®ç¸£",
          "è‡ºæ±ç¸£", "æ¾æ¹–ç¸£", "é‡‘é–€ç¸£", "é€£æ±Ÿç¸£"
        ];

        const COURSE_CATEGORIES = [
          "è·æ¥­å®‰å…¨è¡›ç”Ÿç®¡ç†äººå“¡ (ç”²ä¹™ä¸™ç¨®)",
          "ç‡Ÿé€ æ¥­è·æ¥­å®‰å…¨è¡›ç”Ÿæ¥­å‹™ä¸»ç®¡",
          "å±éšªæ€§æ©Ÿæ¢°åŠè¨­å‚™æ“ä½œäººå“¡ (å¤©è»Šã€å †é«˜æ©Ÿã€é‹çˆ)",
          "æ–½å·¥æ¶çµ„é…/æ¨¡æ¿æ”¯æ’/åœŸçŸ³æ”¯æ’ä½œæ¥­ä¸»ç®¡",
          "æ€¥æ•‘äººå“¡è¨“ç·´",
          "é˜²ç«ç®¡ç†äººå“¡è¨“ç·´",
          "ç‰¹å®šåŒ–å­¸ç‰©è³ª/æœ‰æ©Ÿæº¶åŠ‘ä½œæ¥­ä¸»ç®¡",
          "ç²‰å¡µ/ç¼ºæ°§ä½œæ¥­ä¸»ç®¡",
          "éœ²å¤©é–‹æŒ–/éš§é“æŒ–æ˜ä½œæ¥­ä¸»ç®¡",
          "ç‰©ç†æ€§å› å­ä½œæ¥­ç’°å¢ƒç›£æ¸¬",
          "åŒ–å­¸æ€§å› å­ä½œæ¥­ç’°å¢ƒç›£æ¸¬",
          "ä¸€èˆ¬å‹å·¥å®‰å…¨è¡›ç”Ÿæ•™è‚²è¨“ç·´",
          "å…¶ä»–"
        ];

        const SAFETY_FACTS = [
          "é›‡ä¸»æ‡‰å°å‹å·¥æ‡‰æ–½ä»¥å¾äº‹å·¥ä½œåŠé é˜²ç½è®Šæ‰€å¿…è¦ä¹‹å®‰å…¨è¡›ç”Ÿæ•™è‚²åŠè¨“ç·´ã€‚",
          "å‹å·¥å°æ–¼å®‰å…¨è¡›ç”Ÿä¹‹è¨­æ–½ï¼Œæ‡‰ç¢ºå¯¦éµå®ˆï¼Œä¸å¾—ä»»æ„ç§»å‹•ã€è®Šæ›´æˆ–æ¯€æã€‚",
          "å¾äº‹é«˜ç©ºä½œæ¥­æ™‚ï¼Œå‹å·¥æ‡‰ç¢ºå¯¦é…æˆ´å®‰å…¨å¸¶ï¼Œä¸¦å›ºå®šæ–¼ç©©å›ºä¹‹è™•ã€‚",
          "é€²å…¥å±€é™ç©ºé–“ä½œæ¥­å‰ï¼Œæ‡‰å…ˆå¯¦æ–½é€šé¢¨æ›æ°£ï¼Œä¸¦æ¸¬å®šæ°§æ°£åŠå±éšªæ°£é«”æ¿ƒåº¦ã€‚",
          "ä½¿ç”¨ç§»å‹•å¼èµ·é‡æ©Ÿé€²è¡ŒåŠæ›ä½œæ¥­æ™‚ï¼Œåš´ç¦äººå“¡é€²å…¥åŠå‡ç‰©ä¸‹æ–¹å€åŸŸã€‚",
          "é›‡ä¸»æ‡‰å°åœ¨è·å‹å·¥æ–½è¡Œå®šæœŸå¥åº·æª¢æŸ¥ï¼Œä»¥ç¶­è­·å‹å·¥èº«å¿ƒå¥åº·ã€‚",
          "å‹å·¥å·¥ä½œå ´æ‰€ä¹‹é€šé“ã€åœ°æ¿ã€éšæ¢¯ï¼Œæ‡‰ä¿æŒä¸è‡´ä½¿å‹å·¥è·Œå€’ã€æ»‘å€’ä¹‹ç‹€æ…‹ã€‚",
          "å°æ–¼é«˜åº¦äºŒå…¬å°ºä»¥ä¸Šä¹‹ä½œæ¥­ï¼Œæ‡‰æ§‹ç¯‰æ–½å·¥æ¶æˆ–è¨­ç½®è­·æ¬„ã€åœæ¬„ç­‰é˜²è­·è¨­æ–½ã€‚",
          "æ“ä½œå †é«˜æ©Ÿæ™‚ï¼Œåš´ç¦è² è¼‰è¶…éè¦å®šè² è·ï¼Œä¸”è¡Œé§›ä¸­åš´ç¦äººå“¡æ­ä¹˜ã€‚",
          "å·¥ä½œå ´æ‰€æ‡‰è¨­ç½®é©ç•¶ä¹‹æ¶ˆé˜²å™¨æï¼Œä¸¦å®šæœŸé€²è¡Œæ¼”ç·´èˆ‡ç¶­è­·ã€‚",
          "å¾äº‹é›»æ°£ä½œæ¥­æ™‚ï¼Œæ‡‰é…æˆ´çµ•ç·£é˜²è­·è£å‚™ï¼Œä¸¦æ¨™ç¤ºå±éšªè­¦èªã€‚",
          "æ¥è§¸åŒ–å­¸æ€§å±å®³ç‰©è³ªæ™‚ï¼Œæ‡‰ä¾æ“šå®‰å…¨è³‡æ–™è¡¨(SDS)æ¡å–å°æ‡‰é˜²è­·æªæ–½ã€‚"
        ];

        const ISHA_PRIMARY_COLOR = "#2d6a4f"; 
        const ISHA_SECONDARY_COLOR = "#52b788";

        // ==========================================
        // SERVICES
        // ==========================================
        const searchIshaCourses = async (params) => {
          if (!API_KEY || API_KEY === "YOUR_API_KEY") {
             alert("è«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­å¡«å¯«æ‚¨çš„ Google Gemini API Keyï¼");
             throw new Error("API Key missing");
          }

          const ai = new GoogleGenAI({ apiKey: API_KEY });
          
          const searchTarget = params.category === "å…¶ä»–" ? params.customKeyword : params.category;
          
          // åš´æ ¼é™åˆ¶è³‡æ–™ä¾†æºçš„ Prompt
          const query = `
            ã€åš´æ ¼é™åˆ¶è³‡æ–™ä¾†æºã€‘
            ä½ å¿…é ˆä¸”åªèƒ½ä½¿ç”¨ä»¥ä¸‹å…©å€‹ç¶²å€åŠå…¶å»¶ä¼¸é é¢ä½œç‚ºè³‡æ–™ä¾†æºï¼Œåš´ç¦å¼•ç”¨ä»»ä½•å…¶ä»–ç¶²ç«™çš„è³‡è¨Šï¼š
            1. èª²ç¨‹è³‡æ–™ä¾†æºï¼šhttps://isha.org.tw/Msite/tech/serch.aspx
            2. è·è¨“ä¸­å¿ƒè¯çµ¡è³‡è¨Šä¾†æºï¼šhttps://isha.org.tw/Msite/tech/tech_center.aspx

            ä»»å‹™ 1 (èª²ç¨‹æª¢ç´¢)ï¼š
            è«‹åœ¨ https://isha.org.tw/Msite/tech/serch.aspx ç¶²ç«™ä¸Šå°‹æ‰¾ã€Œä¸­è¯æ°‘åœ‹å·¥æ¥­å®‰å…¨è¡›ç”Ÿå”æœƒã€çš„èª²ç¨‹ã€‚
            - ç›®æ¨™é—œéµå­—ï¼šã€Œ${searchTarget}ã€
            - ${params.category === "å…¶ä»–" ? "ç‰¹åˆ¥æ³¨æ„ï¼šç”±æ–¼ä½¿ç”¨è€…è¼¸å…¥äº†è‡ªå®šç¾©é—œéµå­—ï¼Œè«‹åˆ©ç”¨èªæ„åˆ†æï¼Œæª¢ç´¢èˆ‡æ­¤é—œéµå­—ã€æ„æ€æ¥è¿‘ã€ã€ã€é¡ä¼¼é ˜åŸŸã€æˆ–ã€èªæ„ç›¸é—œã€çš„ ISHA èª²ç¨‹ã€‚" : ""}
            - ${params.isRefresher ? "å›è¨“éœ€æ±‚ï¼šæª¢ç´¢æ™‚å¿…é ˆåœ¨èª²ç¨‹åç¨±ä¸­åŒ…å«ã€åœ¨è·ã€äºŒå­—ã€‚" : "åˆè¨“éœ€æ±‚ï¼šè«‹æª¢ç´¢æ­£å¼çš„åˆè¨“æˆ–ç®¡ç†è·èª²ç¨‹ã€‚"}
            - æ—¥æœŸå€é–“ï¼š${params.startDate} åˆ° ${params.endDate}
            - ç›®æ¨™ç¸£å¸‚ï¼š${params.city}

            ä»»å‹™ 2 (è·è¨“ä¸­å¿ƒè¯çµ¡è³‡è¨Š)ï¼š
            è«‹åˆ° https://isha.org.tw/Msite/tech/tech_center.aspx ç¶²ç«™ä¸Šï¼Œæª¢ç´¢èˆ‡ã€Œ${params.city}ã€åœ°å€ç›¸å°æ‡‰çš„æ‰€æœ‰ã€Œä¸­è¯æ°‘åœ‹å·¥æ¥­å®‰å…¨è¡›ç”Ÿå”æœƒã€è·è¨“ä¸­å¿ƒè¯çµ¡è³‡è¨Šã€‚
            - å¿…é ˆåŒ…å«ï¼šè·è¨“ä¸­å¿ƒåç¨±ã€è©³ç´°åœ°å€ã€é€£çµ¡é›»è©±ã€‚

            è«‹å°‡ä»¥ä¸Šå…©é …ä»»å‹™çš„çµæœæ•´åˆç‚ºä¸€å€‹ JSON ç‰©ä»¶å›å‚³ã€‚
          `;

          try {
            const response = await ai.models.generateContent({
              model: "gemini-2.5-flash", // ä½¿ç”¨é«˜æ•ˆèƒ½æ¨¡å‹é€²è¡Œæœå°‹
              contents: query,
              config: {
                tools: [{ googleSearch: {} }],
                responseMimeType: "application/json",
                responseSchema: {
                  type: Type.OBJECT,
                  properties: {
                    courses: {
                      type: Type.ARRAY,
                      items: {
                        type: Type.OBJECT,
                        properties: {
                          name: { type: Type.STRING, description: "èª²ç¨‹å®Œæ•´åç¨±" },
                          date: { type: Type.STRING, description: "ä¸Šèª²æ—¥æœŸ" },
                          city: { type: Type.STRING, description: "é–‹èª²åŸå¸‚" },
                          centerName: { type: Type.STRING, description: "é–‹èª²çš„è·è¨“ä¸­å¿ƒåç¨±" },
                          address: { type: Type.STRING, description: "è·è¨“ä¸­å¿ƒè©³ç´°åœ°å€" },
                          link: { type: Type.STRING, description: "è©²èª²ç¨‹åœ¨ isha.org.tw ä¸Šçš„å ±åç¶²å€" }
                        },
                        required: ["name", "date", "city", "centerName", "address", "link"]
                      }
                    },
                    centers: {
                      type: Type.ARRAY,
                      items: {
                        type: Type.OBJECT,
                        properties: {
                          name: { type: Type.STRING, description: "è·è¨“ä¸­å¿ƒå®Œæ•´åç¨±" },
                          address: { type: Type.STRING, description: "è©³ç´°åœ°å€" },
                          phone: { type: Type.STRING, description: "é€£çµ¡é›»è©±" }
                        },
                        required: ["name", "address", "phone"]
                      },
                      description: "å¾ tech_center.aspx æª¢ç´¢åˆ°çš„è©²ç¸£å¸‚ç›¸é—œè·è¨“ä¸­å¿ƒè¯çµ¡æ–¹å¼"
                    }
                  },
                  required: ["courses", "centers"]
                }
              },
            });

            const data = JSON.parse(response.text || '{"courses":[], "centers":[]}');
            const sources = response.candidates?.[0]?.groundingMetadata?.groundingChunks || [];

            return {
              courses: (data.courses || []).map((c, index) => ({
                ...c,
                id: `course-${index}`,
                isRefresher: params.isRefresher
              })),
              centers: data.centers || [],
              sources
            };
          } catch (error) {
            console.error("Gemini search failed:", error);
            throw error;
          }
        };

        // ==========================================
        // COMPONENTS
        // ==========================================
        
        // SafetyFactTicker
        const SafetyFactTicker = () => {
          const [index, setIndex] = useState(0);
          const [fade, setFade] = useState(true);

          useEffect(() => {
            const interval = setInterval(() => {
              setFade(false); 
              setTimeout(() => {
                setIndex((prevIndex) => (prevIndex + 1) % SAFETY_FACTS.length);
                setFade(true); 
              }, 500); 
            }, 7000); 

            return () => clearInterval(interval);
          }, []);

          return (
            <div className="bg-green-50 border-2 border-green-200 rounded-xl p-8 shadow-inner min-h-[160px] flex flex-col items-center justify-center text-center transition-all">
              <div className="flex items-center gap-2 mb-4 text-green-800 font-bold uppercase tracking-wider text-sm">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
                </svg>
                å·¥å®‰æ³•è¦å°çŸ¥è­˜
              </div>
              <p 
                className={`text-lg md:text-xl text-gray-700 font-medium leading-relaxed transition-opacity duration-500 ${fade ? 'opacity-100' : 'opacity-0'}`}
                style={{ color: ISHA_PRIMARY_COLOR }}
              >
                ã€Œ {SAFETY_FACTS[index]} ã€
              </p>
              <div className="mt-6 flex gap-1">
                {SAFETY_FACTS.map((_, i) => (
                  <div 
                    key={i} 
                    className={`h-1.5 rounded-full transition-all duration-300 ${i === index ? 'w-6 bg-green-600' : 'w-1.5 bg-green-200'}`}
                  />
                ))}
              </div>
            </div>
          );
        };

        // SearchForm
        const SearchForm = ({ onSearch, isLoading }) => {
          const [params, setParams] = useState({
            startDate: new Date().toISOString().split('T')[0],
            endDate: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
            city: 'è‡ºåŒ—å¸‚',
            category: COURSE_CATEGORIES[0],
            customKeyword: '',
            isRefresher: false
          });

          const handleSubmit = (e) => {
            e.preventDefault();
            onSearch(params);
          };

          return (
            <form onSubmit={handleSubmit} className="bg-white p-6 rounded-xl shadow-lg border-t-4" style={{ borderTopColor: ISHA_PRIMARY_COLOR }}>
              <h2 className="text-xl font-bold mb-6 text-gray-800 flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke={ISHA_PRIMARY_COLOR}>
                  <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                èª²ç¨‹å¿«é€Ÿæª¢ç´¢
              </h2>

              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div className="space-y-1">
                  <label className="block text-sm font-medium text-gray-700">é–‹å§‹æ—¥æœŸ</label>
                  <input
                    type="date"
                    className="w-full p-2 border rounded-md focus:ring-2 focus:ring-green-500 outline-none"
                    value={params.startDate}
                    onChange={(e) => setParams({ ...params, startDate: e.target.value })}
                    required
                  />
                </div>
                <div className="space-y-1">
                  <label className="block text-sm font-medium text-gray-700">çµæŸæ—¥æœŸ</label>
                  <input
                    type="date"
                    className="w-full p-2 border rounded-md focus:ring-2 focus:ring-green-500 outline-none"
                    value={params.endDate}
                    onChange={(e) => setParams({ ...params, endDate: e.target.value })}
                    required
                  />
                </div>

                <div className="space-y-1">
                  <label className="block text-sm font-medium text-gray-700">æƒ³ä¸Šèª²çš„ç¸£å¸‚</label>
                  <select
                    className="w-full p-2 border rounded-md focus:ring-2 focus:ring-green-500 outline-none"
                    value={params.city}
                    onChange={(e) => setParams({ ...params, city: e.target.value })}
                  >
                    {CITIES.map(city => (
                      <option key={city} value={city}>{city}</option>
                    ))}
                  </select>
                </div>

                <div className="space-y-1">
                  <label className="block text-sm font-medium text-gray-700">æƒ³ä¸Šä»€éº¼èª²</label>
                  <select
                    className="w-full p-2 border rounded-md focus:ring-2 focus:ring-green-500 outline-none"
                    value={params.category}
                    onChange={(e) => setParams({ ...params, category: e.target.value })}
                  >
                    {COURSE_CATEGORIES.map(cat => (
                      <option key={cat} value={cat}>{cat}</option>
                    ))}
                  </select>
                </div>
              </div>

              {params.category === 'å…¶ä»–' && (
                <div className="mt-4 space-y-1 animate-fade-in">
                  <label className="block text-sm font-medium text-gray-700">è«‹è¼¸å…¥èª²ç¨‹é—œéµå­—</label>
                  <input
                    type="text"
                    placeholder="ä¾‹å¦‚ï¼šæ–½å·¥æ¶ã€æ€¥æ•‘ã€ä¸™æ¥­..."
                    className="w-full p-2 border rounded-md focus:ring-2 focus:ring-green-500 outline-none border-green-200"
                    value={params.customKeyword}
                    onChange={(e) => setParams({ ...params, customKeyword: e.target.value })}
                    required
                  />
                  <p className="text-[10px] text-gray-500 italic">AI å°‡å”åŠ©æª¢ç´¢èªæ„ã€ç™¼éŸ³æˆ–æ„æ€æ¥è¿‘çš„èª²ç¨‹ã€‚</p>
                </div>
              )}

              <div className="mt-4 flex items-center gap-3 bg-green-50 p-3 rounded-md">
                <input
                  type="checkbox"
                  id="refresher"
                  className="h-5 w-5 rounded border-gray-300 text-green-600 focus:ring-green-500"
                  checked={params.isRefresher}
                  onChange={(e) => setParams({ ...params, isRefresher: e.target.checked })}
                />
                <label htmlFor="refresher" className="text-sm font-medium text-gray-700 cursor-pointer select-none">
                  æ˜¯å¦è¦å›è¨“ï¼Ÿ (å‹¾é¸å¾Œå°‡æª¢ç´¢åŒ…å«ã€Œåœ¨è·ã€ä¹‹èª²ç¨‹)
                </label>
              </div>

              <button
                type="submit"
                disabled={isLoading}
                className="w-full mt-6 py-3 px-4 rounded-md text-white font-bold text-lg transition-all active:scale-[0.98] disabled:bg-gray-400"
                style={{ backgroundColor: isLoading ? '#9ca3af' : ISHA_PRIMARY_COLOR }}
              >
                {isLoading ? (
                  <span className="flex items-center justify-center gap-2">
                    <svg className="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    AI æª¢ç´¢ä¸­...
                  </span>
                ) : 'é–‹å§‹æœå°‹'}
              </button>
            </form>
          );
        };

        // ResultList
        const ResultList = ({ courses, centers, sources, searchedCity }) => {
          const validateLink = (link) => {
            const fallback = "https://isha.org.tw/Msite/tech/serch.aspx";
            if (!link) return fallback;
            
            try {
              const url = new URL(link);
              if (url.hostname.includes('isha.org.tw')) {
                return link;
              }
              return fallback;
            } catch (e) {
              if (link.startsWith('/')) {
                return `https://isha.org.tw${link}`;
              }
              return fallback;
            }
          };

          if (courses.length === 0) {
            return (
              <div className="space-y-6">
                <div className="bg-white p-12 rounded-xl shadow-md text-center">
                  <div className="text-6xl mb-4">ğŸ”</div>
                  <p className="text-gray-500 text-lg">ç›®å‰æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„èª²ç¨‹ï¼Œè«‹èª¿æ•´æ—¥æœŸæˆ–é¡åˆ¥å†è©¦ä¸€æ¬¡ã€‚</p>
                </div>
                
                {centers.length > 0 && (
                  <div className="bg-green-50 p-6 rounded-xl border border-green-100 animate-fade-in">
                    <h4 className="text-lg font-bold text-green-900 mb-4 flex items-center gap-2">
                      <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clipRule="evenodd" />
                      </svg>
                      {searchedCity} åœ°å€ç›¸é—œè·è¨“ä¸­å¿ƒ (è³‡æ–™ä¾†æºï¼šISHA å®˜ç¶²)
                    </h4>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {centers.map((center, idx) => (
                        <div key={idx} className="bg-white p-4 rounded-lg shadow-sm border border-green-50">
                          <h5 className="font-bold text-gray-900">{center.name}</h5>
                          <p className="text-sm text-gray-600 mt-1">ğŸ“ {center.address}</p>
                          <p className="text-sm font-medium text-green-700 mt-1">ğŸ“ {center.phone}</p>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            );
          }

          return (
            <div className="space-y-6 animate-fade-in">
              <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <h3 className="text-xl font-bold text-gray-800">æœå°‹çµæœ ({courses.length})</h3>
                <div className="bg-emerald-50 text-emerald-800 text-sm py-2 px-4 rounded-lg border border-emerald-100 shadow-sm flex items-start gap-2 max-w-md">
                  <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 shrink-0 mt-0.5" viewBox="0 0 20 20" fill="currentColor">
                    <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
                  </svg>
                  <p className="leading-snug">
                    å¦‚æœé€£çµæœªèƒ½è·³è½‰è‡³å°æ‡‰èª²ç¨‹ï¼Œè«‹ç›´æ¥é›»æ´½å°æ‡‰çš„è·è¨“ä¸­å¿ƒï¼Œå”æœƒæœŸå¾…æ‚¨çš„å…‰è‡¨
                  </p>
                </div>
              </div>
              
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {courses.map((course) => {
                  const validatedLink = validateLink(course.link);
                  return (
                    <div 
                      key={course.id} 
                      className="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-shadow border-l-8"
                      style={{ borderLeftColor: course.isRefresher ? ISHA_SECONDARY_COLOR : ISHA_PRIMARY_COLOR }}
                    >
                      <div className="p-6">
                        <div className="flex justify-between items-start mb-3">
                          <span className={`px-2 py-1 rounded text-xs font-bold text-white ${course.isRefresher ? 'bg-emerald-500' : 'bg-green-700'}`}>
                            {course.isRefresher ? 'å›è¨“/åœ¨è·' : 'åˆè¨“'}
                          </span>
                          <span className="text-gray-500 text-sm font-medium">ğŸ“… {course.date}</span>
                        </div>
                        
                        <h4 className="text-lg font-bold text-gray-900 mb-2 leading-tight">
                          {course.name}
                        </h4>
                        
                        <div className="space-y-2 mb-6">
                          <div className="flex items-center gap-2 text-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                              <path fillRule="evenodd" d="M10 2a8 8 0 100 16 8 8 0 000-16zm1 11a1 1 0 11-2 0 1 1 0 012 0zm-1-7a1 1 0 00-1 1v3a1 1 0 002 0V7a1 1 0 00-1-1z" clipRule="evenodd" />
                            </svg>
                            <span className="text-sm">{course.centerName}</span>
                          </div>
                          <div className="flex items-center gap-2 text-gray-600">
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                              <path fillRule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clipRule="evenodd" />
                            </svg>
                            <span className="text-sm">{course.city} - {course.address}</span>
                          </div>
                        </div>
                        
                        <a 
                          href={validatedLink} 
                          target="_blank" 
                          rel="noopener noreferrer"
                          className="block w-full text-center py-2 px-4 rounded-md font-bold text-white transition-colors hover:opacity-90"
                          style={{ backgroundColor: ISHA_PRIMARY_COLOR }}
                        >
                          æŸ¥çœ‹è©³æƒ…èˆ‡å ±å
                        </a>
                      </div>
                    </div>
                  );
                })}
              </div>

              {centers.length > 0 && (
                <div className="mt-8 p-6 bg-green-50 rounded-xl border border-green-100">
                  <h4 className="text-lg font-bold text-green-900 mb-4 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                      <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clipRule="evenodd" />
                    </svg>
                    æ‚¨æ‰€æŸ¥è©¢ç¸£å¸‚çš„è·è¨“ä¸­å¿ƒè¯çµ¡è³‡è¨Š (æª¢ç´¢è‡ªå®˜ç¶²)
                  </h4>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {centers.map((center, idx) => (
                      <div key={idx} className="bg-white p-4 rounded-lg shadow-sm border border-green-50">
                        <h5 className="font-bold text-gray-900">{center.name}</h5>
                        <p className="text-sm text-gray-600 mt-1">ğŸ“ {center.address}</p>
                        <p className="text-sm font-medium text-green-700 mt-1">ğŸ“ {center.phone}</p>
                      </div>
                    ))}
                  </div>
                </div>
              )}

              {sources.length > 0 && (
                <div className="mt-8 p-4 bg-gray-100 rounded-lg">
                  <h4 className="text-sm font-bold text-gray-600 mb-2">è³‡æ–™ä¾†æºï¼š</h4>
                  <ul className="text-xs text-green-700 space-y-1">
                    {sources.map((src, i) => (
                      <li key={i} className="truncate">
                        <a href={src.web?.uri} target="_blank" rel="noopener noreferrer" className="hover:underline">
                          {src.web?.title || src.web?.uri}
                        </a>
                      </li>
                    ))}
                  </ul>
                </div>
              )}
            </div>
          );
        };

        // ==========================================
        // APP COMPONENT
        // ==========================================
        const App = () => {
          const [courses, setCourses] = useState([]);
          const [centers, setCenters] = useState([]);
          const [sources, setSources] = useState([]);
          const [loading, setLoading] = useState(false);
          const [hasSearched, setHasSearched] = useState(false);
          const [error, setError] = useState(null);
          const [lastSearchedCity, setLastSearchedCity] = useState("");

          const handleSearch = async (params) => {
            setLoading(true);
            setError(null);
            setLastSearchedCity(params.city);
            try {
              const result = await searchIshaCourses(params);
              setCourses(result.courses);
              setCenters(result.centers);
              setSources(result.sources);
              setHasSearched(true);
            } catch (err) {
              console.error(err);
              setError("æª¢ç´¢éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¢ºèªç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚");
            } finally {
              setLoading(false);
            }
          };

          return (
            <div className="min-h-screen pb-12 bg-gray-50">
              {/* Header */}
              <header className="bg-white shadow-sm border-b-2 sticky top-0 z-50" style={{ borderBottomColor: ISHA_PRIMARY_COLOR }}>
                <div className="max-w-6xl mx-auto px-4 h-20 flex items-center justify-between">
                  <div className="flex items-center gap-3">
                    <div className="w-12 h-12 bg-green-700 rounded-full flex items-center justify-center text-white font-bold italic text-xl border-2 border-emerald-400 shadow-md">
                      ISHA
                    </div>
                    <div>
                      <h1 className="text-xl font-bold text-gray-900 leading-tight">ä¸­è¯æ°‘åœ‹å·¥æ¥­å®‰å…¨è¡›ç”Ÿå”æœƒ</h1>
                      <p className="text-xs text-gray-500 font-medium tracking-wide">è·è¨“èª²ç¨‹æ™ºæ…§æª¢ç´¢ç³»çµ± (Green Ed.)</p>
                    </div>
                  </div>
                  <div className="hidden md:block">
                    <a href="https://isha.org.tw" target="_blank" rel="noopener noreferrer" className="text-sm font-bold hover:underline" style={{ color: ISHA_PRIMARY_COLOR }}>
                      ISHA å®˜ç¶²
                    </a>
                  </div>
                </div>
              </header>

              <main className="max-w-6xl mx-auto px-4 mt-8">
                <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
                  {/* Sidebar */}
                  <div className="lg:col-span-4">
                    <div className="sticky top-24">
                      <SearchForm onSearch={handleSearch} isLoading={loading} />
                      
                      <div className="mt-6 p-4 bg-green-50 rounded-lg border border-green-200">
                        <h5 className="text-sm font-bold text-green-800 mb-1 flex items-center gap-2">
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clipRule="evenodd" />
                          </svg>
                          å°æ’‡æ­¥
                        </h5>
                        <p className="text-xs text-green-700 leading-relaxed">
                          è‹¥æ‚¨æ˜¯æƒ³è¦åƒåŠ è¤‡è¨“ï¼Œè«‹å‹™å¿…å‹¾é¸ã€Œæ˜¯å¦è¦å›è¨“ã€ï¼ŒAI æœƒè‡ªå‹•å¹«æ‚¨åŠ ä¸Šã€Œåœ¨è·ã€é—œéµå­—é€²è¡Œæ›´ç²¾ç¢ºçš„æª¢ç´¢ã€‚
                        </p>
                      </div>
                    </div>
                  </div>

                  {/* Results Area */}
                  <div className="lg:col-span-8">
                    {error && (
                      <div className="bg-red-50 border border-red-200 text-red-700 p-4 rounded-lg mb-6 flex items-start gap-3 animate-bounce">
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mt-0.5" viewBox="0 0 20 20" fill="currentColor">
                          <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000-16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clipRule="evenodd" />
                        </svg>
                        {error}
                      </div>
                    )}

                    {!hasSearched && !loading && (
                      <div className="bg-white rounded-xl shadow-md p-12 text-center border-dashed border-2 border-gray-200">
                        <div className="text-6xl mb-6 opacity-30">ğŸ«</div>
                        <h3 className="text-xl font-bold text-gray-700 mb-2">æº–å‚™å¥½é–‹å§‹å­¸ç¿’äº†å—ï¼Ÿ</h3>
                        <p className="text-gray-500">åœ¨å·¦å´è¼¸å…¥æ‚¨çš„éœ€æ±‚ï¼Œæˆ‘å€‘å°‡ç‚ºæ‚¨å¾ ISHA å®˜ç¶²æª¢ç´¢æœ€æ–°çš„èª²ç¨‹è³‡è¨Šã€‚</p>
                      </div>
                    )}

                    {loading ? (
                      <div className="space-y-8">
                        {/* Safety Fact Rotation during Loading */}
                        <SafetyFactTicker />
                        
                        {/* Visual Skeleton placeholders below the fact ticker */}
                        <div className="space-y-6">
                          {[1, 2].map(i => (
                            <div key={i} className="animate-pulse bg-white p-6 rounded-xl shadow-sm border-l-8 border-gray-100">
                              <div className="flex-1 space-y-4 py-1">
                                <div className="h-4 bg-gray-100 rounded w-1/4"></div>
                                <div className="h-6 bg-gray-200 rounded w-3/4"></div>
                                <div className="space-y-2">
                                  <div className="h-4 bg-gray-100 rounded"></div>
                                  <div className="h-4 bg-gray-100 rounded w-5/6"></div>
                                </div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    ) : (
                      hasSearched && <ResultList courses={courses} centers={centers} sources={sources} searchedCity={lastSearchedCity} />
                    )}
                  </div>
                </div>
              </main>

              {/* Footer */}
              <footer className="mt-20 py-12 bg-gray-900 text-gray-400">
                <div className="max-w-6xl mx-auto px-4 text-center">
                  <p className="text-sm mb-4 leading-relaxed">æœ¬æ‡‰ç”¨ç¨‹å¼åƒ…æä¾›æœå°‹èˆ‡æª¢ç´¢æœå‹™ï¼Œæ‰€æœ‰èª²ç¨‹è³‡è¨Šä»¥ <a href="https://isha.org.tw" target="_blank" rel="noopener noreferrer" className="text-white hover:underline font-bold">ISHA ä¸­è¯æ°‘åœ‹å·¥æ¥­å®‰å…¨è¡›ç”Ÿå”æœƒ</a> å®˜ç¶²å…¬å‘Šç‚ºæº–ã€‚</p>
                  <div className="w-16 h-1 bg-gray-700 mx-auto mb-6"></div>
                  <p className="text-xs uppercase tracking-widest">Â© 2024 ISHA Course Finder Helper. Powered by Gemini AI.</p>
                </div>
              </footer>
            </div>
          );
        };

        // ==========================================
        // MOUNT
        // ==========================================
        const rootElement = document.getElementById('root');
        const root = ReactDOM.createRoot(rootElement);
        root.render(
          <React.StrictMode>
            <App />
          </React.StrictMode>
        );
    </script>
</body>
</html>